
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Chapter%201%20-%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%A7%88/">
      
      
        <link rel="next" href="../Chapter%203%20-%20%E9%A1%B5%E8%A1%A8/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Chapter 2 操作系统组织 - Wo Es war, soll Ich werden.</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Wo Es war, soll Ich werden." class="md-header__button md-logo" aria-label="Wo Es war, soll Ich werden." data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Wo Es war, soll Ich werden.
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 2   操作系统组织
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  不看也行

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
  Blogs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../partialife/a%20glimpse/" class="md-tabs__link">
          
  
  Partialife

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../%E4%B8%AA%E4%BA%BA%E6%96%87%E5%AD%A6%E7%B4%A2%E5%BC%95/%E4%B8%9C%E6%96%B9/%E8%BE%9B%E8%AF%8D%E5%8D%81%E9%80%89/" class="md-tabs__link">
          
  
  个人文学索引

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Wo Es war, soll Ich werden." class="md-nav__button md-logo" aria-label="Wo Es war, soll Ich werden." data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Wo Es war, soll Ich werden.
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    不看也行
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blogs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rust学习笔记
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%BD%BF%E7%94%A8mkdocs%E5%92%8CGitHub%20Pages%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用mkdocs和GitHub Pages搭建个人博客
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Mit 6 1810
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Mit 6 1810
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文件系统学习笔记
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lab
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Lab
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab/Lab_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab/Lab_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab/Lab_3%20PageTable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 3 PageTable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab/Lab_4%20Trap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 4 Trap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab/Lab_5%20COW/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 5 COW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab/_Preparation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
     Preparation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xv6学习笔记
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Xv6学习笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%201%20-%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%A7%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 1   操作系统概览
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Chapter 2   操作系统组织
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Chapter 2   操作系统组织
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2-1" class="md-nav__link">
    <span class="md-ellipsis">
      2-1 抽象物理资源
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-2-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      2-2 CPU的用户模式、监督者模式与系统调用
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    <span class="md-ellipsis">
      2-3 如何组织内核
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-4-xv6" class="md-nav__link">
    <span class="md-ellipsis">
      2-4 xv6内核的组织方式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-5" class="md-nav__link">
    <span class="md-ellipsis">
      2-5 进程概述
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-6-xv6" class="md-nav__link">
    <span class="md-ellipsis">
      2-6 xv6的第一个进程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      思考部分
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%203%20-%20%E9%A1%B5%E8%A1%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 3   页表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%204%20-%20%E9%99%B7%E9%98%B1%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 4   陷阱与系统调用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Partialife
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Partialife
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../partialife/a%20glimpse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A glimpse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../partialife/partial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Partial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../partialife/partiallllife/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Partiallllife
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kashi
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Kashi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../partialife/kashi/%E3%83%9E%E3%82%B8%E3%83%83%E3%82%AF%E3%82%A2%E3%83%AF%E3%83%BC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    マジックアワー
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    个人文学索引
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            个人文学索引
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    东方
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            东方
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E4%B8%AA%E4%BA%BA%E6%96%87%E5%AD%A6%E7%B4%A2%E5%BC%95/%E4%B8%9C%E6%96%B9/%E8%BE%9B%E8%AF%8D%E5%8D%81%E9%80%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    辛词十选
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    西方
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            西方
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E4%B8%AA%E4%BA%BA%E6%96%87%E5%AD%A6%E7%B4%A2%E5%BC%95/%E8%A5%BF%E6%96%B9/Poems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Poems
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2-1" class="md-nav__link">
    <span class="md-ellipsis">
      2-1 抽象物理资源
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-2-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      2-2 CPU的用户模式、监督者模式与系统调用
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    <span class="md-ellipsis">
      2-3 如何组织内核
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-4-xv6" class="md-nav__link">
    <span class="md-ellipsis">
      2-4 xv6内核的组织方式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-5" class="md-nav__link">
    <span class="md-ellipsis">
      2-5 进程概述
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-6-xv6" class="md-nav__link">
    <span class="md-ellipsis">
      2-6 xv6的第一个进程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      思考部分
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Chapter 2   操作系统组织</h1>

<p>操作系统需要满足以下三个要求：</p>
<ol>
<li>多路复用（满足多个进程使用同一硬件的需求）</li>
<li>隔离（不同进程之间不相互影响）</li>
<li>交互（不同进程之间可以发生通信）</li>
</ol>
<p>为了满足这三点，操作系统按如下讲述的方式组织。</p>
<h3 id="2-1">2-1 抽象物理资源</h3>
<p>操作系统把硬件资源抽象成系统调用，提供接口方便进程使用。这样实现了强隔离-&gt;禁止应用程序直接访问硬件资源，同时方便了程序的编写。</p>
<p>同时，操作系统在进程之间透明地切换硬件CPU，在必要时保存和恢复寄存器状态，保证对于每一个应用程序其执行过程（对它自己来说）都是不中断的（分时）。</p>
<p><code>exec</code> 系统调用把内核调用其他系统调用这一过程也包装成了抽象接口，从而避免了进程对物理内存的直接操作。</p>
<blockquote>
<p>强隔离、多路复用</p>
</blockquote>
<h3 id="2-2-cpu">2-2 CPU的用户模式、监督者模式与系统调用</h3>
<p>实现强隔离需要保证应用程序不能修改操作系统内容（=不能改变操作系统是如何执行其他进程的=不干扰其他进程），不能访问其他进程的内存。</p>
<p>CPU提供实现强隔离的硬件支持。在RISCV中，CPU有三种执行指令的模式：<strong>机器模式</strong>、<strong>监督者（supervisor）模式</strong>和<strong>用户模式</strong>。在机器模式下执行的指令具有完全的权限，一个CPU在机器模式下启动。机器模式主要用于配置计算机。Xv6会在机器模式下执行几条指令，然后转为监督者模式。</p>
<p>监督者模式可以执行特权指令。只能执行用户模式的指令的应用程序运行在用户空间（用户态），运行在监督者模式下的软件为内核（内核态）。也就是用户态到内核态的转换本质是调用了特权指令-&gt;调用内核函数时，CPU提供了一个特殊的指令，可以将CPU从用户模式切换到监督者模式。</p>
<blockquote>
<p>强隔离</p>
</blockquote>
<h3 id="2-3">2-3 如何组织内核</h3>
<p>宏内核：整个操作系统被打包放入内核，所有系统调用都在内核态下运行。xv6即使用宏内核组织。</p>
<p>宏内核的优缺点：</p>
<ul>
<li>优点：操作系统内的所有系统调用都能使用全部的硬件，不需要针对单独的系统调用分辨硬件权限。</li>
<li>缺点：操作系统中不同部分的接口实现复杂，更容易导致内核崩溃。</li>
</ul>
<p>微内核：在用户模式下执行操作系统的大部分指令，只有必须调用特权指令的代码（如在进程间通信）放入内核执行。</p>
<h3 id="2-4-xv6">2-4 xv6内核的组织方式</h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>描述</th>
<th>文件</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>bio.c</td>
<td>文件系统的磁盘块缓冲</td>
<td>proc.c</td>
<td>进程和调度</td>
</tr>
<tr>
<td>console.c</td>
<td>连接到用户键盘和屏幕</td>
<td>sleeplock.c</td>
<td>放弃 CPU 的锁</td>
</tr>
<tr>
<td>entry.S</td>
<td>第一次启动的指令</td>
<td>spinlock.c</td>
<td>不放弃 CPU 的锁</td>
</tr>
<tr>
<td>exec.c</td>
<td><code>exec()</code> 系统调用</td>
<td>start.c</td>
<td>机器模式早期启动代码</td>
</tr>
<tr>
<td>file.c</td>
<td>文件描述符</td>
<td>string.c</td>
<td>C 字符串和字节数组代码库</td>
</tr>
<tr>
<td>fs.c</td>
<td>文件系统</td>
<td>swtch.S</td>
<td>线程切换</td>
</tr>
<tr>
<td>kalloc.c</td>
<td>物理页分配器</td>
<td>syscall.c</td>
<td>系统调用的调度</td>
</tr>
<tr>
<td>kernelvec.S</td>
<td>处理来自内核的陷阱，定时器中断</td>
<td>sysfile.c</td>
<td>文件相关的系统调用</td>
</tr>
<tr>
<td>log.c</td>
<td>文件系统日志记录和崩溃恢复</td>
<td>sysproc.c</td>
<td>进程相关的系统调用</td>
</tr>
<tr>
<td>main.c</td>
<td>启动阶段控制其他模块的初始化</td>
<td>trampoline.S</td>
<td>切换用户/内核模式的汇编</td>
</tr>
<tr>
<td>pipe.c</td>
<td>管道</td>
<td>trap.c</td>
<td>处理陷阱和中断并从中返回</td>
</tr>
<tr>
<td>plic.c</td>
<td>RISC-V 中断控制器</td>
<td>uart.c</td>
<td>串口控制台设备驱动</td>
</tr>
<tr>
<td>printf.c</td>
<td>格式化输出到控制台</td>
<td>virtio_disk.c</td>
<td>磁盘设备驱动</td>
</tr>
<tr>
<td>vm.c</td>
<td>管理页表和地址空间</td>
<td>defs.h</td>
<td>模块间接口的定义</td>
</tr>
</tbody>
</table>
<h3 id="2-5">2-5 进程概述</h3>
<p>进程是操作系统中最基本的隔离单位，是用户与内核交互的第一层抽象。（其后的抽象为：系统调用）</p>
<blockquote>
<p>上面这段我自己当时到底是怎么想的我真的没看懂。。</p>
</blockquote>
<p>进程不能破坏或监视其他进程的内存、CPU等，同时不能破坏内核，以防止隔离机制被破坏。内核用来实现进程的机制包括：用户/监督模式标志、地址空间和线程的时间片轮转。</p>
<p>对于程序，执行过程中进程会为其抽象出一个虚拟的私有机器，地址空间与CPU均是“私有”的，不能被其他进程读写。</p>
<p>Xv6为每个进程维护一个单独的页表，定义该进程的地址空间，通过页表可以将虚拟地址映射成物理地址用于访存。</p>
<p>从页表的底端开始，存放的分别是：用户数据、用户栈、推数据。在地址空间的顶端（地址最大的部分），xv6保留了一页，用于<strong>trampoline</strong>和映射进程<strong>trapframe</strong>的页，以便切换到内核。</p>
<p>进程的状态被维护在结构体 <code>proc</code> 中。每个进程都有一个或多个执行线程（简称线程），线程执行进程的指令，可以被暂停或恢复（为CPU在进程间透明切换提供了可能）。</p>
<p>-&gt; 进程是程序的运行方式，线程是进程的执行单位。</p>
<blockquote>
<p>关于多进程与多线程：
<strong>多进程</strong>：使一个CPU上能够运行多个程序、有自己独立的地址空间 -&gt; 本质为提供了多个不同的指令集（程序），让CPU可以在不同指令集间自由切换
<strong>多线程</strong>：针对某一个程序使用并行思路优化其执行、多个线程使用同一个进程的地址空间（但每个线程仍然有自己独立的状态空间） -&gt; 本质为分别执行某一个指令集中的不同指令以提高执行效率</p>
</blockquote>
<p>线程（要用到）的大部分状态（局部变量、函数调用返回地址）储存在线程的栈中：每个线程有一个用户栈和一个内核栈（ <code>p-&gt;kstack</code> ）。在进程执行用户指令时状态储存在用户栈，而内存栈为空。在进程进入内核时，内核代码在内核栈上执行。</p>
<p>进程的线程在两个栈上交替执行指令：当进程执行RISC-V的 <code>ecall</code> 指令进行系统调用时，提高硬件的权限级别，PC变为内核定义的入口点，线程通过该入口点切换到内核栈，并执行系统调用的内核指令。</p>
<ul>
<li><code>p-&gt;state</code> 表示进程是创建、就绪、运行、等待I/O，还是退出。</li>
<li><code>p-&gt;pagetable</code> 以RISC-V硬件需要的格式保存进程的页表，当进程在用户空间执行时，xv6使分页硬件使用进程的 <code>p-&gt;pagetable</code> 。进程的页表也会记录分配给该进程内存的物理页地址。</li>
</ul>
<h3 id="2-6-xv6">2-6 xv6的第一个进程</h3>
<p>这章直接看书，主要是举例子。</p>
<p>将xv6加载到 <code>0x80000000</code> 开始的内存中</p>
<p>-&gt; 机器模式下CPU开始运行</p>
<p>-&gt; 设置一个栈并声明其空间，执行c代码，进行初始化</p>
<p>-&gt; 在函数 <code>start</code> 中调用 <code>mret</code> 指令从机器模式转换为监督者模式，程序计数器的地址变为 <code>main</code></p>
<p>-&gt; 在 <code>main</code> 中调用 <code>userinit</code> 创建第一个进程（进入用户空间）</p>
<p>-&gt; 调用 <code>exec</code> 重新进入内核，执行 <code>/init</code> 程序，并在 <code>/init</code> 中返回用户空间，启动shell。</p>
<h3 id="_1">思考部分</h3>
<p>有的系统调用在执行完毕后直接退出，有的系统调用还会返回用户程序一些参数。如何返回参数就是难点之一，一般创造一个指向用户的指针然后通过这个指针返回参数给用户。</p>
<p>关于 <code>mret</code> 指令，其实本质是让CPU返回上一个调用的模式，在 <code>start</code> 函数中，即使对于这个启动函数并不存在上一个调用，我们刻意地将上一次调用的模式设为特权者模式，以保证在函数 <code>start</code> 中可以从机器模式顺利切换到监督者模式。</p>
<p>关于xv6中没有涉及的多线程编程：</p>
<p>为了实现并发处理问题，提出<strong>信号量</strong>的概念：</p>
<p>（在这里我们只讨论信号量用于实现多线程同步的情况，关于多进程的同步，请见第六章锁）信号量是一个多线程<strong>共享</strong>的变量，其中的值储存了某种资源的空余数量。</p>
<p>想象一个诊疗间，每次只允许三个病人进入，其余病人必须在确认门上悬挂的电子屏中显示的“剩余可进入人数”来确认自己能否进入。如果“剩余可进入人数”不为0，则一个病人进入且触摸屏上的按钮使“剩余可进入人数”减一；如果“剩余可进入人数”为0，则所有病人必须在外排队，直到诊疗间中有病人出来并触摸屏上的按钮，使“剩余可进入人数”加一。</p>
<p>信号量保证了诊疗间同一时间内只有有限个病人能够使用。</p>
<p>简化后的信号量：互斥量（类似于锁）</p>
<p>将以上的诊疗间模型中的“剩余可进入人数”改为诊疗间门锁，只有上锁与不上锁两种状态：进入诊疗间时必须上锁，在离开诊疗间时解锁。每个病人来到诊疗间前直接尝试拧锁，如果锁为上锁状态则排队，直到锁被出来的病人打开。</p>
<p>互斥量保证了诊疗间同一时间内只有一个病人能够使用。</p>
<p>同时，由于多个线程都会检查信号量，信号量自身也需要进行并发处理（一般为锁），在第一个例子中，我们可以将其转化为：同时只能有一个病人检查门上的电子屏，当有多个病人想要检查电子屏上显示的数字时，他们同样需要排队。（排队限制了同一时间只有一个病人能够操作电子屏，电子屏即使这个例子中的临界区）</p>
<p>思考关于临界区的概念：临界区是共享资源前的一块区域，进程/线程进入这块区域后开始排队准备对共享资源进行操作。临界区自身也算是一种“共享资源”，为了处理对“临界区的共享”，一般也需要对临界区设置锁等操作。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.path"], "search": "../../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>